<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cart • UniThrift</title>
<link rel="stylesheet" href="styles.css">
<style>
  body { background:#fafafa; }
  .cart-item { display:flex; gap:12px; border-bottom:1px solid #eee; padding:16px 0; align-items:center; background:#fff; border-radius:8px; padding:12px; margin-bottom:12px; }
  .cart-item img { width:80px; height:80px; object-fit:cover; border-radius:8px; }
  .cart-info { flex:1; }
  .qty-controls { display:flex; gap:8px; align-items:center; margin-top:8px; }
  .qty-btn { width:32px; height:32px; border:1px solid #ddd; background:#fff; border-radius:6px; cursor:pointer; font-size:16px; font-weight:700; }
  .qty-btn:hover { background:#f5f5f5; border-color:#999; }
  .qty-btn:active { transform:scale(0.95); }
  .remove-btn { color:#dc2626; font-size:13px; cursor:pointer; text-decoration:underline; margin-top:6px; display:inline-block; }
  .remove-btn:hover { color:#991b1b; }
  .empty-state { text-align:center; padding:60px 20px; color:#6b7280; }
  .empty-state svg { width:80px; height:80px; margin-bottom:16px; opacity:0.3; }
  .checkout-section { background:#fff; border-radius:12px; padding:20px; margin-top:20px; border:2px solid #333; }
</style>
</head>
<body>
  <header style="padding:16px;background:#fff;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center">
    <a href="index.html" style="text-decoration:none;color:#1e3a8a;font-weight:600">← Continue shopping</a>
    <a href="listings.html" style="text-decoration:none;color:#6b7280">Browse products</a>
  </header>
  
  <main style="max-width:800px;margin:24px auto;padding:0 16px">
    <h1 style="margin:0 0 20px">Your Cart</h1>
    <div id="list"></div>
    
    <div id="checkoutSection" class="checkout-section" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <span style="font-size:18px;font-weight:600">Total</span>
        <h2 id="total" style="margin:0;font-size:28px"></h2>
      </div>
      <a href="checkout.html" class="btn" style="display:block;text-align:center;text-decoration:none;padding:14px">Proceed to Checkout</a>
      <button onclick="clearCart()" style="width:100%;margin-top:8px;padding:12px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer;color:#6b7280">Clear Cart</button>
    </div>
  </main>
  
  <script>
    function peso(n){ return `₱${Math.round(n).toLocaleString()}`; }
    
    function loadCart(){
      const list = document.getElementById("list");
      const checkoutSection = document.getElementById("checkoutSection");
      
      try {
        const raw = localStorage.getItem("cart") || "[]";
        const cart = JSON.parse(raw);
        
        if(cart.length === 0){
          list.innerHTML = `
            <div class="empty-state">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
              </svg>
              <h3>Your cart is empty</h3>
              <p>Start adding items from our marketplace!</p>
              <a href="listings.html" class="btn" style="display:inline-block;margin-top:12px;text-decoration:none">Browse Products</a>
            </div>
          `;
          checkoutSection.style.display = "none";
          return;
        }
        
        let total = 0;
        list.innerHTML = cart.map((item, idx) => {
          const subtotal = item.price * item.qty;
          total += subtotal;
          return `
            <div class="cart-item">
              <img src="${item.image || 'https://picsum.photos/80'}" alt="${item.name}">
              <div class="cart-info">
                <div style="font-weight:700;font-size:15px">${item.name}</div>
                <div style="color:#6b7280;font-size:13px;margin-top:2px">${item.description || ''}</div>
                <div style="color:#16a34a;font-weight:600;margin-top:4px">${peso(item.price)} each</div>
                <div class="qty-controls">
                  <button class="qty-btn" onclick="updateQty(${idx}, -1)">−</button>
                  <span style="min-width:30px;text-align:center;font-weight:600">${item.qty}</span>
                  <button class="qty-btn" onclick="updateQty(${idx}, 1)">+</button>
                </div>
                <a class="remove-btn" onclick="removeItem(${idx})">Remove</a>
              </div>
              <div style="font-weight:700;font-size:16px">${peso(subtotal)}</div>
            </div>
          `;
        }).join("");
        
        document.getElementById("total").textContent = peso(total);
        checkoutSection.style.display = "block";
        
      } catch(e) {
        console.error("Cart load error:", e);
        list.innerHTML = "<p style='color:#dc2626;padding:20px;text-align:center'>Error loading cart. Please refresh the page.</p>";
        localStorage.removeItem("cart"); // Clear corrupted data
      }
    }
    
    function updateQty(idx, change){
      try {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        cart[idx].qty += change;
        
        if(cart[idx].qty <= 0){
          cart.splice(idx, 1); // Remove if quantity is 0
        }
        
        localStorage.setItem("cart", JSON.stringify(cart));
        loadCart();
      } catch(e) {
        console.error("Update quantity error:", e);
        alert("Error updating quantity. Please refresh.");
      }
    }
    
    function removeItem(idx){
      if(!confirm("Remove this item from cart?")) return;
      
      try {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        cart.splice(idx, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        loadCart();
      } catch(e) {
        console.error("Remove item error:", e);
        alert("Error removing item. Please refresh.");
      }
    }
    
    function clearCart(){
      if(!confirm("Clear all items from cart?")) return;
      localStorage.removeItem("cart");
      loadCart();
    }
    
    loadCart();
  </script>
</body></html>