<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UniThrift • Listings</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:16px; padding:16px; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; }
    .card img { width:100%; height:160px; object-fit:cover; border-radius:8px; }
    .price { font-weight:800; font-size:1.1rem; color:#16a34a; }
    .description { color:#6b7280; font-size:13px; line-height:1.4; }
    .toolbar { display:flex; gap:8px; align-items:center; padding:12px 16px; background:#fff; border-bottom:1px solid #eee; }
    .badge { position:relative; top:-1px; margin-left:4px; font-size:12px; background:#16a34a; color:#fff; padding:2px 6px; border-radius:999px; }
    .addBtn { padding:8px 12px; background:#1e3a8a; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600; margin-top:4px; }
    .addBtn:hover { background:#1e40af; }
  </style>
</head>
<body>
  <header style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#fff;border-bottom:1px solid #eee">
    <a href="index.html" style="font-weight:800;text-decoration:none;color:#1e3a8a">UniThrift</a>
    <nav>
      <a href="index.html">Home</a>
      <a href="cart.html">Cart <span id="cartBadge" class="badge" style="display:none">0</span></a>
    </nav>
  </header>

  <div class="toolbar">
    <strong id="title">All Items</strong>
    <span id="activeFilters" style="color:#6b7280"></span>
  </div>

  <main class="grid" id="grid"></main>

  <script>
    // --- DEMO DATA with descriptions
    const products = [
      { 
        id:"b-101", 
        name:"GE Book: Ethics", 
        price:120, 
        description:"Lightly used GE book. Minimal highlights. Perfect for Term 2.",
        campus:"ADMU", 
        category:"Books", 
        image:"https://picsum.photos/seed/book/400/300" 
      },
      { 
        id:"s-201", 
        name:"A4 Bond Paper (500s)", 
        price:180, 
        description:"Brand new, sealed pack. Great for printing reports.",
        campus:"ADMU", 
        category:"School Supplies", 
        image:"https://picsum.photos/seed/paper/400/300" 
      },
      { 
        id:"g-301", 
        name:"Wired Earphones", 
        price:150, 
        description:"Working condition. Good bass. Includes case.",
        campus:"UPD", 
        category:"Gadgets", 
        image:"https://picsum.photos/seed/ear/400/300" 
      },
      { 
        id:"p-401", 
        name:"Preloved Hoodie", 
        price:130, 
        description:"Size M. Slight fading but very comfy. No holes.",
        campus:"ADMU", 
        category:"Preloved", 
        image:"https://picsum.photos/seed/hood/400/300" 
      },
      { 
        id:"b-102", 
        name:"Calculus Textbook", 
        price:200, 
        description:"Complete with solution manual. Barely used.",
        campus:"ADMU", 
        category:"Books", 
        image:"https://picsum.photos/seed/calc/400/300" 
      },
      { 
        id:"g-302", 
        name:"Wireless Mouse", 
        price:180, 
        description:"Logitech M170. Battery included. Works perfectly.",
        campus:"UPD", 
        category:"Gadgets", 
        image:"https://picsum.photos/seed/mouse/400/300" 
      },
    ];

    const params = new URLSearchParams(location.search);
    const campus = params.get("campus");
    const category = params.get("category");
    const priceMin = Number(params.get("priceMin")) || 0;
    const priceMax = Number(params.get("priceMax")) || Infinity;

    function formatPeso(n){ return `₱${Math.round(n).toLocaleString()}`; }

    function filterProducts(list){
      return list.filter(p =>
        (!campus || p.campus === campus) &&
        (!category || p.category === category) &&
        (p.price >= priceMin && p.price <= priceMax)
      );
    }

    function renderGrid(list){
      const el = document.getElementById("grid");
      el.innerHTML = "";
      
      if(list.length === 0){
        el.innerHTML = "<p style='grid-column:1/-1;text-align:center;padding:40px;color:#6b7280'>No products found. Try different filters.</p>";
        return;
      }
      
      list.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}" loading="lazy"/>
          <div style="display:flex;flex-direction:column;gap:4px;flex:1">
            <div style="font-weight:700;font-size:15px">${p.name}</div>
            <div class="description">${p.description}</div>
            <div class="price">${formatPeso(p.price)}</div>
            <div style="color:#6b7280;font-size:12px">${p.campus} • ${p.category}</div>
          </div>
          <button data-id="${p.id}" class="addBtn">Add to Cart</button>
        `;
        el.appendChild(card);
      });
      
      document.querySelectorAll(".addBtn").forEach(btn=>{
        btn.addEventListener("click", () => addToCart(btn.getAttribute("data-id")));
      });
    }

    function updateHeader(){
      const t = document.getElementById("title");
      const f = document.getElementById("activeFilters");
      const parts = [];
      if (campus) parts.push(campus);
      if (category) parts.push(category);
      if (isFinite(priceMax) || priceMin>0) parts.push(`₱${priceMin||0}–${isFinite(priceMax)?priceMax:"∞"}`);
      t.textContent = parts.length ? parts.join(" · ") : "All Items";
      f.textContent = "";
    }

    function addToCart(productId){
      const item = products.find(p => p.id === productId);
      if(!item) return;
      
      try {
        const raw = localStorage.getItem("cart") || "[]";
        const cart = JSON.parse(raw);
        
        // Find existing item (using 'id' not 'productId')
        const idx = cart.findIndex(i => i.id === productId);
        
        if (idx >= 0) {
          // Increase quantity (using 'qty' not 'quantity')
          cart[idx].qty += 1;
        } else {
          // Add new item with standardized structure
          cart.push({ 
            id: productId,        // ✅ Standardized: 'id'
            name: item.name, 
            price: item.price, 
            qty: 1,               // ✅ Standardized: 'qty'
            image: item.image,
            description: item.description
          });
        }
        
        localStorage.setItem("cart", JSON.stringify(cart));
        updateCartBadge();
        
        // Visual feedback
        const btn = document.querySelector(`[data-id="${productId}"]`);
        const originalText = btn.textContent;
        btn.textContent = "Added!";
        btn.style.background = "#16a34a";
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = "#1e3a8a";
        }, 1000);
        
      } catch(e) {
        console.error("Add to cart error:", e);
        alert("Error adding to cart. Please try again.");
      }
    }

    function updateCartBadge(){
      const badge = document.getElementById("cartBadge");
      try {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const qty = cart.reduce((n,i)=>n+(i.qty||1),0);
        if(qty>0){ 
          badge.textContent = qty; 
          badge.style.display = "inline-block"; 
        } else { 
          badge.style.display = "none"; 
        }
      } catch { 
        badge.style.display = "none"; 
      }
    }

    updateHeader();
    renderGrid(filterProducts(products));
    updateCartBadge();
  </script>
</body>
</html>