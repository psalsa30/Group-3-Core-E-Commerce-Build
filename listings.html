<!DOCTYPE html>
<html lang="en">
<head>
<!-- SEO meta tags -->
<meta name="description" content="UniThrift is a student marketplace for buying and selling preloved items safely near your campus.">
<meta name="keywords" content="UniThrift, student marketplace, preloved items, Ateneo, campus shop">
<meta name="author" content="Group 3 - UniThrift">

<!-- Open Graph (for social media preview) -->
<meta property="og:title" content="UniThrift – Buy & Sell Preloved Campus Items">
<meta property="og:description" content="Find trusted sellers and affordable preloved goods near your university.">
<meta property="og:image" content="https://unithrift.netlify.app/preview.png">
<meta property="og:url" content="https://unithrift.netlify.app/">

<!-- Mobile-friendly -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UniThrift • Listings</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap:16px; padding:16px; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; }
    .card img { width:100%; height:140px; object-fit:cover; border-radius:8px; }
    .price { font-weight:800; }
    .toolbar { display:flex; gap:8px; align-items:center; padding:12px 16px; }
    .badge { position:relative; top:-1px; margin-left:4px; font-size:12px; background:#16a34a; color:#fff; padding:2px 6px; border-radius:999px; }
  </style>
</head>
<body>
  <header style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#fff;border-bottom:1px solid #eee">
    <a href="index.html" style="font-weight:800;text-decoration:none;color:#1e3a8a">UniThrift</a>
    <nav>
      <a href="index.html">Home</a>
      <a href="cart.html">Cart <span id="cartBadge" class="badge" style="display:none">0</span></a>
    </nav>
  </header>

  <div class="toolbar">
    <strong id="title">All Items</strong>
    <span id="activeFilters" style="color:#6b7280"></span>
  </div>

  <main class="grid" id="grid"></main>

  <script>
    // --- demo data (replace with API later)
    const products = [
      { id:"b-101", name:"GE Book: Ethics", price:120, campus:"ADMU", category:"Books", image:"https://picsum.photos/seed/book/400/300" },
      { id:"s-201", name:"A4 Bond Paper (500s)", price:180, campus:"ADMU", category:"School Supplies", image:"https://picsum.photos/seed/paper/400/300" },
      { id:"g-301", name:"Wired Earphones", price:150, campus:"UPD", category:"Gadgets", image:"https://picsum.photos/seed/ear/400/300" },
      { id:"p-401", name:"Preloved Hoodie", price:130, campus:"ADMU", category:"Preloved", image:"https://picsum.photos/seed/hood/400/300" },
    ];

    const params = new URLSearchParams(location.search);
    const campus = params.get("campus");            // e.g., ADMU
    const category = params.get("category");        // e.g., Books
    const priceMin = Number(params.get("priceMin")) || 0;
    const priceMax = Number(params.get("priceMax")) || Infinity;

    function formatPeso(n){ return `₱${n.toFixed(0)}` }

    function filterProducts(list){
      return list.filter(p =>
        (!campus || p.campus === campus) &&
        (!category || p.category === category) &&
        (p.price >= priceMin && p.price <= priceMax)
      );
    }

    function renderGrid(list){
      const el = document.getElementById("grid");
      el.innerHTML = "";
      list.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}"/>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">${p.name}</div>
              <div class="price">${formatPeso(p.price)}</div>
              <div style="color:#6b7280;font-size:12px">${p.campus} • ${p.category}</div>
            </div>
            <button data-id="${p.id}" class="addBtn">Add</button>
          </div>
        `;
        el.appendChild(card);
      });
      document.querySelectorAll(".addBtn").forEach(btn=>{
        btn.addEventListener("click", () => addToCart(btn.getAttribute("data-id")));
      });
    }

    function updateHeader(){
      const t = document.getElementById("title");
      const f = document.getElementById("activeFilters");
      const parts = [];
      if (campus) parts.push(campus);
      if (category) parts.push(category);
      if (isFinite(priceMax) || priceMin>0) parts.push(`₱${priceMin||0}–${isFinite(priceMax)?priceMax:"∞"}`);
      t.textContent = parts.length ? parts.join(" · ") : "All Items";
      f.textContent = params.toString() ? `Filters: ${params.toString()}` : "";
    }

    function addToCart(productId){
      const item = products.find(p => p.id === productId);
      if(!item) return;
      const raw = localStorage.getItem("cart") || "[]";
      const cart = JSON.parse(raw);
      const idx = cart.findIndex(i => i.productId === productId);
      if (idx >= 0) cart[idx].quantity += 1;
      else cart.push({ productId, name:item.name, price:item.price, quantity:1, image:item.image });
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartBadge();
    }

    function updateCartBadge(){
      const badge = document.getElementById("cartBadge");
      try {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const qty = cart.reduce((n,i)=>n+(i.quantity||1),0);
        if(qty>0){ badge.textContent = qty; badge.style.display = "inline-block"; }
        else { badge.style.display = "none"; }
      } catch { badge.style.display = "none"; }
    }

    updateHeader();
    renderGrid(filterProducts(products));
    updateCartBadge();
  </script>
</body>
</html>
